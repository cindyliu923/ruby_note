# 串接電子地圖

當 user 結帳時，顯示選項：

- 宅配
- 全家店到店

選擇全家店到店之後，頁面下方的填地址區域就變成顯示已選擇的門市，以及一個`選擇門市`按鈕。

按下`選擇門市`按鈕後，（原頁 or 開新分頁）跳頁至(綠界map or 我們另外做的網頁)

選擇門市後跳轉回(結帳頁 or 我們另外做的網頁)


## 如何保存跳頁至`選擇門市`時，之前填入的訂單狀態
選擇門市按鈕按下時，(patch？)打到的是我們的網頁，存好資訊之後再 redirect 到綠界map

## 如何接受來自綠界的門市資訊
從綠界那邊選好之後 (post？)打回我們的網頁，存好資訊之後再 redirect 到訂單頁

## 不改變訂單狀態的情況下修改訂單資訊
在被綠界打的時候，需要略過 CSRF 檢查
可以透過 ExtraData[string(20)] 欄位來確認 request 是否來自同一個 user
某些 API 會提供 CheckMacValue 來作為 CSRF 檢查

同時也要檢查訂單是否在可編輯的情況（尚未結帳）


